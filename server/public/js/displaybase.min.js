/*! displaybase 08-05-2015 */
var AppModel=Backbone.Model.extend({initialize:function(){console.log(window.data),this.set("rowCollection",new RowCollection(data.header))}}),ContentModel=Backbone.Model.extend({popup:function(a){this.trigger("popup",this,a)}}),RowModel=Backbone.Model.extend({initialize:function(){var a=data.content[this.get("name")];this.set("contentCollection",new ContentCollection(a))}}),ContentCollection=Backbone.Collection.extend({model:ContentModel,initialize:function(){this.on("popup",function(a,b){new PopView({model:a,evt:b})})}}),RowCollection=Backbone.Collection.extend({model:RowModel}),AppView=Backbone.View.extend({className:"container-fluid",initialize:function(){this.render(),window.watch=new this.Watch(100,1e3,function(){$("#popup").remove(),window.watch.reset()}),Headroom.options.offset=40,Headroom.options.tolerance={down:5,up:50},$(".headroom").headroom(),$(".content").css({width:data.settings.contentWidth+"px",height:data.settings.contentHeight+"px"}),$(".gallery").smoothDivScroll({manualContinuousScrolling:!0}).smoothDivScroll("move",30).smoothDivScroll("move",-30)},render:function(){var a=this;this.model.get("rowCollection").each(function(b){var c=new RowView({model:b});a.$el.append(c.render())}),$body=$("body"),$body.empty(),$body.append(this.$el),$(".container-fluid").prepend('<div class="header-buffer"></div>');var b=new HeaderView;$(".header-buffer").append(b.render())},Watch:function(a,b,c){this.currentTime=0,this.timeLimit=b||3e3;var d;this.start=function(){d||(d=setInterval(this.addTime.bind(this),a||500))},this.stop=function(){return d&&(clearInterval(d),d=null),this},this.reset=function(){return this.currentTime=0,this.stop(),this},this["do"]=function(){c()},this.addTime=function(){this.currentTime+=a,this.currentTime>=this.timeLimit&&this["do"]()}},loadCSS:function(a){if(!document.getElementById(a+"-css")){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.id=a+"-css",c.rel="stylesheet",c.type="text/css",c.href="styles/"+a+".css",b.appendChild(c)}}}),ContentView=Backbone.View.extend({className:"content",template:_.template('<span class="content-img"><a class="content-link" href=<%- contentUrl %>><img class="img" src=<%- imgUrl %>></a></span>'),events:{mouseenter:"popup"},initialize:function(){this.render()},render:function(){return this.$el.html(this.template({title:this.model.get("title"),imgUrl:this.model.get("thumbnail"),contentUrl:this.model.get("link")})),this.$el},popup:function(a){this.model.popup(a)}}),HeaderView=Backbone.View.extend({template:_.template('<a href=<%- url %> ><h4 id="display-title"><span id="displaybase">DisplayBase</span><span id="js">.js</span></h4></a><a href="https://github.com/PerplexingQuasar/perplexing-quasar"><i class="fa fa-github"></i></a>'),className:"headroom",id:"headroom",intialize:function(){this.render()},render:function(){return this.$el.html(this.template({url:""})),this.$el}}),PopView=Backbone.View.extend({className:"hidden",id:"popup",events:{mouseenter:"enter",mouseleave:"leave"},template:_.template("<span id='arrow'></span><div id='popup-header'><%- popupHeader %></div><div id='popup-content'><%- popupContent %></div>"),initialize:function(a){this.render(),this.popController(a.evt)},render:function(){$("#popup").remove(),this.$el.html(this.template({popupHeader:this.model.get("title"),popupContent:this.model.get("description")})),$("body").append(this.$el)},popController:function(a){a.preventDefault();var b=$("#popup"),c=function(a){b.removeClass("hidden")};window.cancel=setTimeout(c.bind(this,a),500),this.popPosition(a,b)},popPosition:function(a,b){var c={},d=27,e=$(a.currentTarget).offset();e.width=a.currentTarget.offsetWidth;var f=b.width(),g=e.left+e.width+f+d;g>window.innerWidth?(c.top=e.top+25,c.left=e.left-d-f,$("#arrow").removeClass("arrow-to-left"),$("#arrow").addClass("arrow-to-right"),$("#arrow").css({left:f})):(c.top=e.top+25,c.left=e.left+d+e.width,$("#arrow").removeClass("arrow-to-right"),$("#arrow").addClass("arrow-to-left"),$("#arrow").css({left:-d})),b.css(c),$(a.currentTarget).on("mouseleave",function(a){a.preventDefault(),window.watch.start()}),$(a.currentTarget).on("mouseenter",function(a){a.preventDefault(),window.watch.reset()})},enter:function(){window.watch.reset(),console.log("entered popup")},leave:function(){window.watch.start(),console.log("left popup")}}),RowView=Backbone.View.extend({className:"row",template:_.template("<h3><%- rowName %></h3><section class='gallery'></section>"),initialize:function(){this.render()},render:function(){var a=this;return this.$el.html(this.template({rowName:this.model.get("name")})),this.model.get("contentCollection").each(function(b){var c=new ContentView({model:b});a.$(".gallery").append(c.render())}),this.$el}});